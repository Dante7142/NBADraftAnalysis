---
title: "NBADraftAnalysis"
output: html_document
date: "2025-05-12"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r}

library(dplyr)
library(stringi)
library(hoopR)
library(ggplot2)


```

## R Markdown
```{r}
#reads the csvs
NBADraftData <-read.csv("~/Downloads/DraftData1995-2015 .csv")

PlayerID <- read.csv("~/Downloads/NBA_Player_IDs.csv")
PlayerID <- rename(PlayerID, Player=BBRefName)
```

```{r}
#renaming and removing columns
NBADraftData <- NBADraftData %>%
  select(X.1, X.2, Round.1, X.4,Totals, Shooting, X.9, X.10, Per.Game, X.11, X.12, X.13, Advanced, X.14, X.15, X.16,)
NBADraftData<-rename(NBADraftData, Pick=X.1, Team=X.2, Years=X.4, "FGPercent"=Shooting, "ThreePointPercent"=X.9, "FreeThrowPercent"= X.10, "MPG" = Per.Game, PTS = X.11, TRB=X.12, AST=X.13, WS=Advanced, "WS/48"=X.14, BPM=X.15, VORP=X.16, Player=Round.1, GamesPlayed=Totals)

```

```{r}
#standardizes player names
NBADraftData$Player <- stri_trans_general(NBADraftData$Player, "Latin-ASCII")
DraftData <- left_join(
  NBADraftData,
  PlayerID %>% select(NBAName, NBAID),
  by = c("Player" = "NBAName")
)

```
```{r}
#dataset filtering
DraftData[DraftData == ""] <- 0
DraftData <- DraftData %>%
  mutate(
    PTS = as.numeric(PTS),
    TRB = as.numeric(TRB),
    AST = as.numeric(AST),
    ThreePointPercent = as.numeric(ThreePointPercent),
    FGPercent = as.numeric(FGPercent),
    FreeThrowPercent = as.numeric(FreeThrowPercent),
    GamesPlayed = as.numeric(GamesPlayed),
    MPG = as.numeric(MPG),
    Years = as.numeric(Years),
    Pick = as.numeric(Pick),
    WS = as.numeric(WS),
    `WS/48`= as.numeric(`WS/48`),
    VORP=as.numeric(VORP)
  )
DraftData <- DraftData %>%
  filter(DraftData$Years > 2)

```

```{r}
#Takes out duplicates
DraftData <- DraftData %>% distinct(Player, .keep_all = TRUE)
```

```{r}
#get steals blocks and turnovers
new_column_values <- rep(NA, nrow(DraftData))
DraftData <- cbind(DraftData, STL = new_column_values, BLK = new_column_values, TOV = new_column_values)
# first initialize the vectors outside the loop
#gets steals, blocks and turnovers
new_steals <- c()
new_blocks <- c()
new_turnovers <- c()


for (i in DraftData$NBAID) {
  Sys.sleep(0.5)
  
  if (is.na(i)) {
    next  # skip this iteration
  }
  
  stringNBAID <- as.character(i)
  print(paste("Working on player ID:", stringNBAID))
  
  PlayerCareerStats <- nba_playercareerstats(
    league_id = "00",
    per_mode = "Totals",
    player_id = stringNBAID
  )
  
  PlayerSteals <- PlayerCareerStats$CareerTotalsRegularSeason["STL"]
  PlayerBlocks <- PlayerCareerStats$CareerTotalsRegularSeason["BLK"]
  PlayerTurnovers <- PlayerCareerStats$CareerTotalsRegularSeason["TOV"]
  
  # preview what you got from the API
  print(paste("ID:", stringNBAID, 
              "STL:", PlayerSteals, 
              "BLK:", PlayerBlocks, 
              "TOV:", PlayerTurnovers))
  
  # store them into your running vectors
  new_steals[stringNBAID] <- PlayerSteals
  new_blocks[stringNBAID] <- PlayerBlocks
  new_turnovers[stringNBAID] <- PlayerTurnovers
}
DraftData$STL <- new_steals[as.character(DraftData$NBAID)]
DraftData$BLK <- new_blocks[as.character(DraftData$NBAID)]
DraftData$TOV <- new_turnovers[as.character(DraftData$NBAID)]


```

```{r}
#Manual Entering for PlayerIDs that did not merge:
DraftData$STL[101] <- 228
DraftData$BLK[101] <- 411
DraftData$TOV[101] <- 101

DraftData$STL[66] <- 6
DraftData$BLK[66] <- 2
DraftData$TOV[66] <- 7

DraftData$STL[179] <- 25
DraftData$BLK[179] <- 35
DraftData$TOV[179] <- 68

DraftData$STL[213] <- 17
DraftData$BLK[213] <- 64
DraftData$TOV[213] <- 40

DraftData$STL[228] <- 2
DraftData$BLK[228] <- 2
DraftData$TOV[228] <- 2

DraftData$STL[292] <- 189
DraftData$BLK[292] <- 75
DraftData$TOV[292] <- 370

DraftData$STL[295] <- 404
DraftData$BLK[295] <- 100
DraftData$TOV[295] <- 742

DraftData$STL[311] <- 73
DraftData$BLK[311] <- 107
DraftData$TOV[311] <- 277

DraftData$STL[358] <- 974
DraftData$BLK[358] <- 204
DraftData$TOV[358] <- 1315

DraftData$STL[403] <- 601
DraftData$BLK[403] <- 254
DraftData$TOV[403] <- 724

DraftData$STL[450] <- 943
DraftData$BLK[450] <- 243
DraftData$TOV[450] <- 816

DraftData$STL[509] <- 274
DraftData$BLK[509] <- 309
DraftData$TOV[509] <- 774

DraftData$STL[519] <- 39
DraftData$BLK[519] <- 57
DraftData$TOV[519] <- 65

DraftData$STL[574] <- 125
DraftData$BLK[574] <- 9
DraftData$TOV[574] <- 229

DraftData$STL[613] <- 2
DraftData$BLK[613] <- 9
DraftData$TOV[613] <- 6

DraftData$STL[616] <- 296
DraftData$BLK[616] <- 393
DraftData$TOV[616] <- 1076

DraftData$STL[682] <- 36
DraftData$BLK[682] <- 33
DraftData$TOV[682] <- 60

DraftData$STL[764] <- 13
DraftData$BLK[764] <- 3
DraftData$TOV[764] <- 12

DraftData$STL[767] <- 70
DraftData$BLK[767] <- 94
DraftData$TOV[767] <- 151

DraftData$STL[770] <- 32
DraftData$BLK[770] <- 19
DraftData$TOV[770] <- 77

DraftData$STL[806] <- 18
DraftData$BLK[806] <- 4
DraftData$TOV[806] <- 13




```


```{r}
#create averages for steals, blocks and turnovers
DraftData$STL <- as.numeric(unlist(DraftData$STL))
DraftData$BLK <- as.numeric(unlist(DraftData$BLK))
DraftData$TOV <- as.numeric(unlist(DraftData$TOV))
DraftData <- DraftData %>%
  mutate(STL = (STL)/as.numeric(GamesPlayed), BLK = (BLK)/as.numeric(GamesPlayed), TOV = (TOV)/as.numeric(GamesPlayed) )
DraftData$STL <- round(DraftData$STL, digits = 3)
DraftData$BLK <- round(DraftData$BLK, digits = 3)
DraftData$TOV <- round(DraftData$TOV, digits = 3)


```

```{r}
#Create AvailabilityScore
DraftData <- DraftData %>%
  mutate(
    MaxGames = as.numeric(Years) * 82,
    AvailabilityScore = GamesPlayed / MaxGames
  )
```


```{r}
#merge player positions to dataset
OnlyPlayer <- subset(DraftData, select = c(Player))
write.csv(OnlyPlayer, "~/Downloads/SportsAnalyticsProjects/NBADraftAnalysis/OnlyPlayer.csv")
library(dplyr)
library(readr)
library(stringi)
library(stringr)
library(hoopR)

# 1) load your names (expects a 'Player' col; keeps it unchanged)
players <- read_csv("OnlyPlayer.csv", show_col_types = FALSE)
if (!"Player" %in% names(players)) names(players)[1] <- "Player"
players <- players %>% mutate(Player = as.character(Player))

# 2) pull NBA Player Index (internet; includes POSITION)
pi <- hoopR::nba_playerindex(historical = 1)$PlayerIndex

# Build two lookup tables for exact joins
idx_fl <- pi %>%
  transmute(name_fl = paste0(PLAYER_FIRST_NAME, " ", PLAYER_LAST_NAME),
            Position = POSITION) %>%
  group_by(name_fl) %>% summarise(Position = Position[1], .groups = "drop")

idx_lf <- pi %>%
  transmute(name_lf = paste0(PLAYER_LAST_NAME, ", ", PLAYER_FIRST_NAME),
            Position_lf = POSITION) %>%
  group_by(name_lf) %>% summarise(Position_lf = Position_lf[1], .groups = "drop")

# 3) exact join on "First Last"
out <- players %>%
  left_join(idx_fl, by = c("Player" = "name_fl"))

# 4) exact join on "Last, First" for still-missing
if (any(is.na(out$Position))) {
  out_missing <- out %>%
    filter(is.na(Position)) %>%
    mutate(Player_lf = if_else(str_detect(Player, "\\s"),
                               paste0(word(Player, -1), ", ", word(Player, 1, -2)),
                               Player))
  out_filled <- out_missing %>%
    left_join(idx_lf, by = c("Player_lf" = "name_lf")) %>%
    mutate(Position = coalesce(Position, Position_lf)) %>%
    select(-Player_lf, -Position_lf)

  out <- out %>%
    filter(!is.na(Position)) %>%
    bind_rows(out_filled)
}

# 5) fuzzy fallback with base R adist() (no new packages)
if (any(is.na(out$Position))) {
  # normalized copies ONLY for matching; original Player stays unchanged
  idx_names_norm <- str_squish(stri_trans_general(tolower(idx_fl$name_fl), "Latin-ASCII"))
  pos_vec <- idx_fl$Position

  missing_idx <- which(is.na(out$Position))
  for (k in missing_idx) {
    p_raw  <- out$Player[k]
    p_norm <- str_squish(stri_trans_general(tolower(p_raw), "Latin-ASCII"))
    d <- adist(p_norm, idx_names_norm, ignore.case = TRUE)
    j <- which.min(d)
    min_d <- d[j]
    # simple guard: accept if edit distance is small vs name length
    rel <- min_d / max(1, nchar(p_norm))
    if (!is.na(min_d) && (min_d <= 2 || rel <= 0.12)) {
      out$Position[k] <- pos_vec[j]
    }
  }
}

# 6) final df (no files written)
players_positions_df <- out %>%
  transmute(Player, Position = if_else(is.na(Position), "Unknown", Position))

# (optional) see quick stats
unknown_n <- sum(players_positions_df$Position == "Unknown")
cat("Players:", nrow(players_positions_df), " | Unknown positions:", unknown_n, "\n")
# collapse to a single primary position: G / F / C
primary_pos <- function(x) {
  vapply(x, function(pos) {
    if (is.na(pos) || pos == "") return(NA_character_)
    s <- tolower(pos)

    # find earliest mention of each bucket
    ix_g <- min(c(regexpr("pg", s), regexpr("sg", s), regexpr("guard", s), regexpr("\\bg\\b", s)))
    ix_f <- min(c(regexpr("sf", s), regexpr("pf", s), regexpr("forward", s), regexpr("\\bf\\b", s)))
    ix_c <- min(c(regexpr("center", s), regexpr("\\bc\\b", s)))

    idx <- c(G = ix_g[1], F = ix_f[1], C = ix_c[1])
    idx[idx == -1] <- Inf

    if (all(is.infinite(idx))) {
      # fallback: take first g/f/c that appears in the string (covers "g-f", "f/c", etc.)
      m <- regexpr("[gfc]", s)
      if (m == -1) return(NA_character_) else return(toupper(substr(s, m, m)))
    } else {
      return(names(which.min(idx)))
    }
  }, character(1))
}

# apply to your df
players_positions_df$Position <- primary_pos(players_positions_df$Position)
players_positions_df$Position[is.na(players_positions_df$Position)] <- "Unknown"
```


```{r}
#manually enter players with wrong or missing positions and merge to main dataset
players_positions_df$Position[73] <- "F"
players_positions_df$Position[48] <- "G"
players_positions_df$Position[702] <- "C"
players_positions_df$Position[795] <- "G"
players_positions_df$Position[796] <- "G"
players_positions_df$Position[797] <- "C"
players_positions_df$Position[807] <- "F"
players_positions_df$Position[810] <- "F"
players_positions_df$Position[816] <- "F"
players_positions_df$Position[73] <- "F"

DraftData <- DraftData %>% left_join(players_positions_df, by = "Player")
```



```{r}
set.seed(83)
library(dplyr)
library(glmnet)
# install.packages(c("Hmisc")) # for rcorr p-values
library(Hmisc)

# --- 0) columns & helpers ---
feature_cols <- c("PTS","TRB","AST","STL","BLK","TOV",
                  "FGPercent","FreeThrowPercent","ThreePointPercent")

to_numeric <- function(df, cols) {
  for (cn in cols) if (cn %in% names(df)) df[[cn]] <- as.numeric(df[[cn]])
  df
}

r2_fn <- function(y_true, y_pred) {
  ss_res <- sum((y_true - y_pred)^2, na.rm = TRUE)
  ss_tot <- sum((y_true - mean(y_true, na.rm = TRUE))^2, na.rm = TRUE)
  1 - ss_res/ss_tot
}

# --- 1) one-position trainer that returns everything you asked for ---
fit_position <- function(data, position_name, y_col = "VORP",
                         test_frac = 0.2, save_models = TRUE) {

  df <- data %>% filter(Position == position_name) %>% 
    select(all_of(c(feature_cols, y_col))) %>% na.omit()

  if (nrow(df) < 20) stop(paste("Not enough rows for position", position_name))

  # split
  n <- nrow(df)
  idx_test <- sample(seq_len(n), size = ceiling(test_frac * n))
  test  <- df[idx_test, ]
  train <- df[-idx_test, ]

  # scale with train params
  x_train <- scale(as.matrix(train[, feature_cols]))
  x_test  <- scale(as.matrix(test[,  feature_cols]),
                   center = attr(x_train, "scaled:center"),
                   scale  = attr(x_train, "scaled:scale"))
  y_train <- train[[y_col]]
  y_test  <- test[[y_col]]

  # ridge with CV
  cvfit <- cv.glmnet(x_train, y_train, alpha = 0, standardize = FALSE)
  model <- glmnet(x_train, y_train, alpha = 0, lambda = cvfit$lambda.min,
                  standardize = FALSE)

  # weights (drop intercept), normalize to sum |w| = 1
  w <- as.numeric(coef(model))[-1]
  names(w) <- colnames(x_train)
  w_norm <- w / sum(abs(w))
  weights_tbl <- tibble(Position = position_name,
                        Stat = names(w_norm),
                        Weight = as.numeric(w_norm))

  # test metrics
  pred_test <- as.numeric(predict(model, newx = x_test))
  r2_test   <- r2_fn(y_test, pred_test)
  rmse_test <- sqrt(mean((y_test - pred_test)^2))
  metrics_tbl <- tibble(Position = position_name,
                        Model = "Ridge (lambda.min)",
                        R2_Test = r2_test,
                        RMSE_Test = rmse_test,
                        N_Train = nrow(train), N_Test = nrow(test))

  # correlations (+ p-values) among features
  rc <- Hmisc::rcorr(as.matrix(df[, feature_cols]))
  cor_mat <- rc$r
  p_mat   <- rc$P

  # OLS for p-values (diagnostic only; multicollinearity caveats apply)
  # Use same train set (unscaled is fine for p-values)
  ols_df <- train
  ols_formula <- as.formula(
    paste(y_col, "~", paste(feature_cols, collapse = " + "))
  )
  ols_fit <- lm(ols_formula, data = ols_df)
  ols_summary <- summary(ols_fit)

  # extract tidy-ish OLS table
  ols_table <- as.data.frame(ols_summary$coefficients)
  ols_table$Predictor <- rownames(ols_table)
  rownames(ols_table) <- NULL
  names(ols_table) <- c("Estimate","StdError","t","p_value","Predictor")
  ols_table <- ols_table %>% filter(Predictor != "(Intercept)") %>%
    arrange(p_value)

  # optionally save model to disk
  if (save_models) {
    saveRDS(list(model = model,
                 cv = cvfit,
                 center = attr(x_train,"scaled:center"),
                 scale  = attr(x_train,"scaled:scale"),
                 features = feature_cols,
                 y_col = y_col,
                 position = position_name),
            file = paste0("ridge_", position_name, ".rds"))
  }

  list(
    weights = weights_tbl,
    metrics = metrics_tbl,
    cor_matrix = cor_mat,
    cor_pvalues = p_mat,
    ols_table = ols_table
  )
}

# --- 2) run for your data (expects FinalDraftData with numeric features + Position + VORP) ---
# Ensure numerics
FinalDraftData <- read.csv("FinalDraftData.csv")
FinalDraftData <- to_numeric(FinalDraftData, c(feature_cols, "VORP"))
FinalDraftData$Position <- factor(FinalDraftData$Position, levels = c("G","F","C"))

res_G <- fit_position(FinalDraftData, "G")
res_F <- fit_position(FinalDraftData, "F")
res_C <- fit_position(FinalDraftData, "C")

# collect weights & metrics
all_weights <- bind_rows(res_G$weights, res_F$weights, res_C$weights)
all_metrics <- bind_rows(res_G$metrics, res_F$metrics, res_C$metrics)

print(all_weights)
print(all_metrics)

# example: view top OLS signals for guards
head(res_G$ols_table, 10)

# example: correlation matrix for forwards (values and p-values)
res_F$cor_matrix[1:5, 1:5]
res_F$cor_pvalues[1:5, 1:5]

```

```{r}
# PerformanceScore
DraftData <- DraftData %>%
  mutate(
    PerformanceScore= case_when(
      Position == "G" ~ (
         0.3643590224	*PTS + 0.1680422451	*TRB + 0.1915565534	*AST + 0.0502018637	*STL + 0.1179875371	*BLK - 0.0114203810	*TOV - 0.0196260790	*FGPercent + 0.0180259115		*FreeThrowPercent +0.0587804068		*ThreePointPercent+ 0.015	*AvailabilityScore
      ),
      Position == "F" ~ (
        0.2498149599	*PTS + 0.0528860681	*TRB + 0.4003164475	*AST - 0.0150143829	*STL + 0.1257441821	*BLK -0.1051423144	*TOV - 0.0100611978	*FGPercent - 0.0228781508	*FreeThrowPercent  - 0.0181422966	*ThreePointPercent +0.015*AvailabilityScore
      ),
      Position == "C" ~ (
        0.1567796142	*PTS + 0.1133047432	*TRB + 0.377695524*AST - 0.0007074915	*STL + 0.0913250405*	BLK - 0.1527700789	*TOV + 0.0571077744	*FGPercent -0.0174904306	*FreeThrowPercent + 0.0324260233	*ThreePointPercent +0.015*AvailabilityScore
      ),
      TRUE ~ NA_real_
    )
  )


```



```{r}
#Average of PerformanceScores per Pick=ExpectedScore
write.csv(DraftData, "~/Downloads/SportsAnalyticsProjects/NBADraftAnalysis/DraftData.csv")
DraftDataFiltered <- DraftData
DraftDataFiltered <- DraftDataFiltered %>%
  mutate(DraftBin = case_when(
    Pick >= 1 & Pick <= 15  ~ "1-15",
    Pick >= 16 & Pick <= 30 ~ "16-30",
    Pick >= 31 & Pick <= 60 ~ "31-60",
    TRUE ~ "Other"
  ))
avg_by_pick <- DraftDataFiltered %>%
  group_by(Pick) %>%
  summarise(
    ExpectedScore = mean(PerformanceScore, na.rm = TRUE),
    Count = n()
  )
```

```{r}
# Make FinalScore
FinalDraftData <- DraftDataFiltered
FinalDraftData$Position[462] <- "F"
FinalDraftData$PerformanceScore[462] <- 2.9676235745
FinalDraftData <- FinalDraftData %>%
   left_join(avg_by_pick, by = "Pick")
FinalDraftData <- FinalDraftData %>%
  group_by(Pick) %>% 
  mutate(
    FinalScore = (PerformanceScore - mean(PerformanceScore, na.rm = TRUE)) 
  ) %>%
  ungroup()
```

```{r}
write.csv(FinalDraftData, "~/Downloads/SportsAnalyticsProjects/NBADraftAnalysis/FinalDraftData.csv")
```

```{r}
#make the final leaderboards
leaderboards <- FinalDraftData %>%
  filter(!is.na(Position), !is.na(FinalScore)) %>%
  group_by(Position) %>%
  arrange(desc(FinalScore), .by_group = TRUE) %>%
  mutate(PosRank = row_number()) %>%
  ungroup()
  leaderboards <- subset(leaderboards, select = c(Player, Pick, Position, PosRank, FinalScore, Team))
```

```{r}
#manually enter teams for players with the wrong ones
leaderboards$Team[leaderboards$Player %in% c("Rasheed Wallace")] <- "WAS"
leaderboards$Team[leaderboards$Player %in% c("Dwight Powell",
  "Frank Kaminsky",
  "Noah Vonleh",
  "Shabazz Napier",
  "Jamaal Magloire",
  "George Zidek",
  "Ricky Davis",
  "Malik Rose",
  "Lee Nailon",
  "Kobe Bryant",
  "Baron Davis",
  "Tony Delk",
  "George Zidek")] <- "CHA"
leaderboards$Team[leaderboards$Player %in% c("Bryant Reeves",
  "Shareef Abdur-Rahim",
  "Roy Rogers",
  "Obinna Ekezie",
  "Stromile Swift",
  "Steve Francis",
  "Mike Bibby",
  "Lawrence Moten",
  "Antonio Daniels")] <- "MEM"
leaderboards$Team[leaderboards$Player %in% c("Hilton Armstrong", "Julian Wright", "Cedric Simmons")] <- "NOH"
leaderboards$Team[leaderboards$Player %in% c("Mason Plumlee", "Chris McCullough", "Pat Connaughton")] <- "NJN"
leaderboards$Team[leaderboards$Player %in% c("Mark Blount",
  "Johan Petro",
  "Robert Swift",
  "Vladimir Stepania",
  "Olumide Oyedeji",
  "Mouhamed Sene",
  "Kevin Durant",
  "Rashard Lewis",
  "Corey Maggette",
  "Serge Ibaka",
  "Bobby Simmons",
  "Carl Landry",
  "Glen Davis",
  "Vladimir Radmanovic",
  "Nick Collison",
  "Jelani McCoy",
  "Mickael Gelabale",
  "Russell Westbrook",
  "Desmond Mason",
  "Bobby Jackson",
  "Luke Ridnour",
  "Earl Watson",
  "Willie Green",
  "Drew Barry")] <- "OKC"
write.csv(leaderboards, "~/Downloads/SportsAnalyticsProjects/NBADraftAnalysis/leaderboards.csv")
```


```{r}
# make team summary
library(dplyr)

team_summary <- leaderboards %>%
  group_by(Team) %>%
  summarise(
    AvgFinalScore = mean(FinalScore, na.rm = TRUE),
    MedianFinalScore = median(FinalScore, na.rm = TRUE),
    Count = n()
  ) %>%
  arrange(desc(AvgFinalScore))
write.csv(team_summary, "~/Downloads/SportsAnalyticsProjects/NBADraftAnalysis/team_summary.csv")
```

```{r}
#graph of best player vs worst player per draft pick
library(ggplot2)
library(dplyr)
library(ggrepel)

positions <- c("G", "F", "C")

for (pos in positions) {
  pos_data <- FinalDraftData %>%
    filter(Pick <= 15, Position == pos)

  pos_summary <- pos_data %>%
    group_by(Pick) %>%
    summarise(
      BestPlayer = Player[which.max(PerformanceScore)],
      BestScore = max(PerformanceScore, na.rm = TRUE),
      WorstPlayer = Player[which.min(PerformanceScore)],
      WorstScore = min(PerformanceScore, na.rm = TRUE)
    )

  p <- ggplot() +
    geom_point(data = pos_summary, aes(x = Pick, y = BestScore),
               color = "darkgreen", size = 3) +
    geom_text_repel(data = pos_summary, aes(x = Pick, y = BestScore, label = BestPlayer),
                    color = "darkgreen", size = 3, nudge_y = 1.2) +
    geom_point(data = pos_summary, aes(x = Pick, y = WorstScore),
               color = "red3", size = 3) +
    geom_text_repel(data = pos_summary, aes(x = Pick, y = WorstScore, label = WorstPlayer),
                    color = "red3", size = 3, nudge_y = -1.2) +
    scale_x_continuous(breaks = 1:15) +
    labs(
      title = paste0("Lottery Picks (1–15): Best and Worst ", pos, "s by Draft Pick"),
      subtitle = "Green = Best Performer | Red = Worst Performer",
      x = "Draft Pick",
      y = "Performance Score"
    ) +
    theme_minimal(base_size = 13) +
    theme(
      plot.title = element_text(face = "bold", hjust = 0.5),
      plot.subtitle = element_text(hjust = 0.5)
    )

  print(p)
}
```

```{r}
#find players closest to average per pick
for (pos in positions) {
  pos_data <- FinalDraftData %>%
    filter(Pick <= 15, Position == pos)

  pos_summary <- pos_data %>%
    group_by(Pick) %>%
    summarise(
      AvgPerformance = mean(PerformanceScore, na.rm = TRUE),
      ClosestPlayer = Player[which.min(abs(PerformanceScore - mean(PerformanceScore, na.rm = TRUE)))],
      ClosestScore = PerformanceScore[which.min(abs(PerformanceScore - mean(PerformanceScore, na.rm = TRUE)))]
    )

  p <- ggplot(pos_summary, aes(x = Pick)) +
    geom_line(aes(y = AvgPerformance), color = "blue", size = 1.2) +
    geom_point(aes(y = ClosestScore), color = "black", size = 2.5) +
    geom_text_repel(aes(y = ClosestScore, label = ClosestPlayer),
                    color = "black", size = 3, nudge_y = 0.5) +
    scale_x_continuous(breaks = 1:15) +
    labs(
      title = paste0("Lottery Picks (1–15): Average Performance and Representative ", pos, "s"),
      subtitle = "Blue line = Avg PerformanceScore | Black dots = Closest to Average",
      x = "Draft Pick",
      y = "Performance Score"
    ) +
    theme_minimal(base_size = 13) +
    theme(
      plot.title = element_text(face = "bold", hjust = 0.5),
      plot.subtitle = element_text(hjust = 0.5)
    )

  print(p)
}
```

```{r}
library(ggplot2)
library(dplyr)

# Sort teams by average score for nicer visual order
team_summary <- team_summary %>%
  arrange(desc(AvgFinalScore)) %>%
  mutate(Team = factor(Team, levels = Team))

# Plot average FinalScore per team
ggplot(team_summary, aes(x = Team, y = AvgFinalScore, group = 1)) +
  geom_line(color = "steelblue", size = 1.2) +
  geom_point(color = "steelblue", size = 3) +
  labs(
    title = "Average FinalScore by Team",
    x = "Team",
    y = "Average FinalScore"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(face = "bold", hjust = 0.5)
  )

```

```{r}
library(ggplot2)
library(dplyr)

FinalDraftData <- read.csv("FinalDraftData.csv")

# Average performance by pick (ignore Position)
pick_summary <- FinalDraftData %>%
  group_by(Pick) %>%
  summarise(
    AvgPerformance = mean(PerformanceScore, na.rm = TRUE),
    .groups = "drop"
  )

# Plot
ggplot(pick_summary, aes(x = Pick, y = AvgPerformance)) +
  geom_line(linewidth = 1.3) +
  geom_point(size = 2) +
  scale_x_continuous(breaks = seq(1, max(pick_summary$Pick, na.rm = TRUE), by = 5)) +
  labs(
    title = "Average Player Performance by Draft Pick",
    subtitle = "Mean PerformanceScore aggregated across all positions",
    x = "Draft Pick",
    y = "Average Performance Score"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    legend.position = "none"
  )







```

```{r}
ggplot(pos_pick_summary, aes(x = factor(Pick), y = AvgPerformance, fill = Position)) +
  geom_col(position = "dodge") +
  labs(
    title = "Average PerformanceScore by Pick and Position",
    subtitle = "Bars show relative strength by position for each draft pick",
    x = "Draft Pick",
    y = "Average Performance Score"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    legend.position = "top"
  )
```

